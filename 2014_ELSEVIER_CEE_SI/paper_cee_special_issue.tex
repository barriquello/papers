%% This is file `elsarticle-template-2-harv.tex',
%%
%% Copyright 2009 Elsevier Ltd
%%
%% This file is part of the 'Elsarticle Bundle'.
%% ---------------------------------------------
%%
%% It may be distributed under the conditions of the LaTeX Project Public
%% License, either version 1.2 of this license or (at your option) any
%% later version.  The latest version of this license is in
%%    http://www.latex-project.org/lppl.txt
%% and version 1.2 or later is part of all distributions of LaTeX
%% version 1999/12/01 or later.
%%
%% The list of all files belonging to the 'Elsarticle Bundle' is
%% given in the file `manifest.txt'.
%%
%% Template article for Elsevier's document class `elsarticle'
%% with harvard style bibliographic references
%%
%% $Id: elsarticle-template-2-harv.tex 155 2009-10-08 05:35:05Z rishi $
%% $URL: http://lenova.river-valley.com/svn/elsbst/trunk/elsarticle-template-2-harv.tex $
%%

\documentclass[final,authoryear,3p,twocolumn]{elsarticle}


%% Use the option review to obtain double line spacing
%\documentclass[authoryear,preprint,review,12pt]{elsarticle}

%\documentclass[preprint,authoryear,12pt]{elsarticle}

%% Use the options 1p,twocolumn; 3p; 3p,twocolumn; 5p; or 5p,twocolumn
%% for a journal layout:
%% \documentclass[final,authoryear,1p,times]{elsarticle}
%% \documentclass[final,authoryear,1p,times,twocolumn]{elsarticle}
%% \documentclass[final,authoryear,3p,times]{elsarticle}
%% \documentclass[final,authoryear,3p,times,twocolumn]{elsarticle}
%% \documentclass[final,authoryear,5p,times]{elsarticle}
%\documentclass[final,authoryear,5p,times,twocolumn]{elsarticle}

%% if you use PostScript figures in your article
%% use the graphics package for simple commands
%% \usepackage{graphics}
%% or use the graphicx package for more complicated commands
 \usepackage{graphicx}
\usepackage{caption}
\usepackage{subcaption}

%% or use the epsfig package if you prefer to use the old commands
%% \usepackage{epsfig}
\usepackage{epstopdf}
\usepackage{ifpdf}
%% The amssymb package provides various useful mathematical symbols
\usepackage{amssymb}
%% The amsthm package provides extended theorem environments
\usepackage{amsthm}
\usepackage{algorithmic}
\usepackage{algorithm}
\usepackage[cmex10]{amsmath}
%\usepackage{mathtools}

\newtheorem{theorem}{Theorem}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{mydef}{Definition}
\def\tm{\leavevmode\hbox{$\rm {}^{TM}$}}

\usepackage{pgfplots}
\usetikzlibrary{arrows,automata,petri}
\usetikzlibrary{shapes,snakes,positioning}


%% The lineno packages adds line numbers. Start line numbering with
%% \begin{linenumbers}, end it with \end{linenumbers}. Or switch it on
%% for the whole article with \linenumbers after \end{frontmatter}.
%% \usepackage{lineno}

%% natbib.sty is loaded by default. However, natbib options can be
%% provided with \biboptions{...} command. Following options are
%% valid:

%%   round  -  round parentheses are used (default)
%%   square -  square brackets are used   [option]
%%   curly  -  curly braces are used      {option}
%%   angle  -  angle brackets are used    <option>
%%   semicolon  -  multiple citations separated by semi-colon (default)
%%   colon  - same as semicolon, an earlier confusion
%%   comma  -  separated by comma
%%   authoryear - selects author-year citations (default)
%%   numbers-  selects numerical citations
%%   super  -  numerical citations as superscripts
%%   sort   -  sorts multiple citations according to order in ref. list
%%   sort&compress   -  like sort, but also compresses numerical citations
%%   compress - compresses without sorting
%%   longnamesfirst  -  makes first citation full author list
%%
%% \biboptions{longnamesfirst,comma}

% \biboptions{}

\journal{Computers and Electrical Engineering}

\begin{document}

\begin{frontmatter}

%% Title, authors and addresses

%% use the tnoteref command within \title for footnotes;
%% use the tnotetext command for the associated footnote;
%% use the fnref command within \author or \address for footnotes;
%% use the fntext command for the associated footnote;
%% use the corref command within \author for corresponding author footnotes;
%% use the cortext command for the associated footnote;
%% use the ead command for the email address,
%% and the form \ead[url] for the home page:
%%
%% \title{Title\tnoteref{label1}}
%% \tnotetext[label1]{}
%% \author{Name\corref{cor1}\fnref{label2}}
%% \ead{email address}
%% \ead[url]{home page}
%% \fntext[label2]{}
%% \cortext[cor1]{}
%% \address{Address\fnref{label3}}
%% \fntext[label3]{}

\title{A smart street lighting system based on IPv6-enabled wireless sensor network}

%% use optional labels to link authors explicitly to addresses:
%% \author[label1,label2]{<author name>}
%% \address[label1]{<address>}
%% \address[label2]{<address>}
%Special Issue on Green Engineering Towards Sustainable Smart Cities

\author{Carlos Henrique Barriquello, Gustavo Weber Denardin}
%\address{Electronic Ballast Researching Group (GEDRE) - Intelligence in Lighting, Federal University of Santa Maria(UFSM), Santa Maria, RS, 97105-900, Brazil}


\begin{abstract}
%% Text of abstract
In this paper, we propose propose a smart street lighting system based on IPv6-enabled wireless sensor network. We discuss the main drawbacks of RPL routing protocol for P2P communication in large-scale 6LoWPAN networks. Then, we address such drawbacks by proposing a new routing algorithm, named GeoRank, which integrates RPL protocol with GOAFR position-based routing protocol. Simulations were performed on networks extracted from real street maps. The obtained results show that GeoRank finds shorter routes than RPL in high link density conditions and GOAFR in low link density conditions. Thus, GeoRank shows to be adaptive to variable link densities found in large-scale networks. Further, GeoRank avoids the use of bandwidth-consuming control messages required in RPL, while being more scalable in terms of memory usage than storing-mode RPL.
\end{abstract}


%Specifications: include 3 to 5 bullet points (max. 85 characters per bullet point including spaces); only the core results of the paper should be covered.

%Highlights
%
%We propose a smart street lighting system based on a IPv6-enabled wireless sensor networks.
%
%Main drawbacks of RPL protocol for P2P communication are discussed.
%
%We propose a new routing algorithm, termed GeoRank, which integrates RPL protocol with GOAFR geographic routing protocol.
%
%Simulations were performed on networks extracted from real street maps.
%
%Results show that GeoRank performs better in large-scale networks with variable link densities than GOAFR or RPL protocols alone.
%
%We discuss the scalability of GeoRank in terms of memory and bandwidth consumption in comparison to RPL protocol.

%- We propose a smart street lighting system based on IPv6-enabled wireless sensor network.
%- Main drawbacks of RPL protocol for P2P communication are discussed.
%- We propose a new routing algorithm, GeoRank, which integrates RPL and GOAFR protocols.
%- Simulations were performed on networks extracted from real street maps.
%- GeoRank is adaptive to variable link densities found in large-scale networks.
%- We discuss the scalability of GeoRank in comparison to RPL protocol.


\begin{keyword}
%% keywords here, in the form: keyword \sep keyword
Wireless Sensor and Actuator Networks  \sep Smart Street Lighting \sep Routing \sep IPv6 \sep 6LoWPAN

%% MSC codes here, in the form: \MSC code \sep code
%% or \MSC[2008] code \sep code (2000 is the default)


\end{keyword}

\end{frontmatter}

% \linenumbers

%% main text
\section{Introduction}


The street lighting system of a city plays an important role on its infrastructure. It is responsible of guaranteeing the society security and living during nighttime, traffic safety, and city appearance. Most commonly used lamp types in street lighting are the high pressure discharge lamps, e.g.: mercury vapor lamps, high-pressure sodium (HPS) lamps, and metal halide (MH) lamps \citep{HID_Lamps_2008,HID_Lamps_2009,HID_Lamps_2010a,HID_Lamps_2010b}. However, with the efficiency and color quality of light emitting diodes (LEDs) steadily improving, LED lamps have been recently introduced as an alternative to replace the conventional lighting systems \citep{LED_conf_2009,LED_conf_2010,LED_jou_2010a,LED_jou_2010b}. 

The use of LEDs in street lighting systems started to be reported in the last few years, and it is being considered a very good solution to replace the HID-based lighting systems, because of the longer lifetime, higher luminous efficiency in mesopic visual conditions, and higher CRI \citep{CRI_2008,CRI_2010}. Moreover, LED lamps may also be dimmed to reduce its power consumption. However, LED lamps are usually less cheaper than HID lamps, and thus become an important asset in the system. Therefore, the presence of LED lamps in the modern street lighting systems brings a need for better management, in order to decrease the maintenance cost and power consumption (e.g.: by lamp dimming).

The addition of communication capability to the street lighting system goes towards such a goal. With a communication network, one can monitor the status information of each lamp (state, current, voltage and power measurements, etc.) and have better control of the system (e.g.: dimming). 
If the system is connected to a network, the lamp power can be monitored and the luminary can be quickly replaced when failure happens, because a decrease of active power consumption is observed. Not only a preventive maintenance of the system can be easily programmed, but also software updates can be done (which allows future enhancements and new functions addition). Then, a street lighting system with communication capability is justified by its advantages.

However, the street lighting systems features a large number of independent devices, with geographic distribution depending on the city streets. Then, adding communication capabilities to these devices requires a complex network topology, as well as interoperability, scalability, security, robustness, low cost, ease to use and maintenance. A few contributions in the literature suggest some technologies that can be used to control a street lighting system. Some use the power lines for data transmission (PLC) \citep{PLC_Street_Lighting_2003,PLC_Street_Lighting_2006}, while others use wireless communication, such as cellular networks \citep{Cellular_Street_Lighting_2009_1,Cellular_Street_Lighting_2010_1}, wireless sensor networks \citep{WSN_Street_Lighting_2010_1, WSN_Street_Lighting_2010_2} and both combined \citep{WSN_Street_lighting_2006, WSN_Street_lighting_2007}.

Main drawbacks of the PLC technology are noisy medium, high signal attenuation, susceptibility to interference from nearby devices, high cost, high complexity and poor scalability. Similarly, the scalability and reliability of cellular networks are questionable, especially under high load traffic. On the other hand, wireless sensor networks scalability is highly dependent on the routing algorithm performance. Therefore, designing a routing algorithm with high scalability and low overhead is a challenging requirement.

Recently, IETF has been standardized 6LoWPAN protocol (RFC4944) as an adaptation layer to enable IEEE 802.15.4-based low power and lossy networks (LLNs), such as wireless sensor networks, to reuse existing IPv6 protocol for networking layer. The IP protocol is an open, mature and field proven technology, with free and well documented standards (RFCs), and thus it is very reasonable to reuse it for wireless sensor networking instead of creating new proprietary protocols. However, 6LoWPAN protocol does not define the routing protocol, which shall be defined apart. Thus, IETF has standardized RPL as the routing protocol for IP-based LLNs.

However, very recent empirical studies showed that RPL has some drawbacks, as higher amount of control messages than data messages, mainly for constructing routes from the sink to the nodes (Downward Routes in RPL vocabulary) \citep{Heurtefeux_RPL_2013}. By the other hand, in a street light system, nodes are static and a routing protocol could benefit of this condition to find routes with less control overhead than RPL. The routing algorithms that use position to find routes in a communication network are known as geographic routing algorithms and a large body of literature has been devoted to the research on those algorithms in last few decades \citep{Karp_GPSR_2000, Position_Based_Routing_Ad_Hoc_2001, On_Optimal_Geographic_Routing_2007, Denardin2011}.



%Paper outline:
%
%Introduction to the street lighting system and problems (0.5 pg) (OK)
%%-	Energy usage, lamps vs efficiency, HPS lamps, LED lamps, etc?
%%-	Required features of smart street lighting systems: energy/power measurement, lamp control (on/off/dimming), system diagnostics, failure report, etc?
%%-	The smart street lighting wireless node:  block diagram of smart street lighting wireless node and prototype (isso talvez poderia ser colocado como resultado)
%
%3) Network structure: base stations and router nodes (0.5 pg)
%3a) routing layer: why geographical routing? geographical routing  algorithms (1pg)
%3b) Network stack with 6LoWPAN, why use 6LoWPAN (0.5 pg)
%3c) Routing algorithms in 6LoWPAN: mesh under x route over. Existing protocols (RPL, DYMO, LOAD, etc..) (1.5 pg). Why not use these? 
%3d) proposal for geographic routing support in 6LoWPAN  (1 pg).  Compare to SPEED or to RPL? %(http://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&arnumber=6058995)
%
%4) results and discussion of design choices, code/data footprint, processing time, data structures, algorithm implementation, etc? (0.5 pg)
%
%5) conclusions: opportunities, challenges and future research directions (0.5 pg)

\section{6LoWPAN}
\label{sec6LoWPAN}

6LoWPAN is a protocol definition, standardized in RFC4944 and RFC6282, that works as an adaptation layer between the IPv6 network layer and the IEEE 802.15.4 MAC (Media Access Control) layer, as depicted in figure \ref{stack_6lowpan}. It is required because IEEE 802.15.4 standard, which defines MAC and PHY layers for low power and low data rate wireless networks, is able to carry packets with maximum size of 127 bytes, while IPv6 packets requires a MTU (minimum transmission unit) of 1280 bytes. Thus, the overall goal of 6LoWPAN is to allow IPv6 packets to be carried on top of IEEE 802.15.4-based wireless sensor networks, by defining fragmentation and compression mechanisms of the IPv6 packets and thus enabling IPv6-based wireless sensor networks \citep{Mulligan_6LoWPAN_2007}.

In addition to fragmentation and header compression, 6LoWPAN also supports mesh networks, as most wireless sensor networks are expected to require multi-hop communication. Two possible configurations for mesh networking are defined by 6LoWPAN: \textit{mesh under} and \textit{route over}. In mesh under, the mesh networking must be provided by the link layer and all IPv6 hosts are only one IP hop away from the border router that is connected to an external IP network (this router is known as 6LoWPAN Border Router (6LBR)). By the other hand, in route over, the routing is done at the IP layer and hosts may be multiple IP hops away from a 6LBR. Thus, every router in the networks act as an IP router. However, although 6LoWPAN supports mesh networking, the decision of how mesh routing is actually performed is out of the scope of the 6LoWPAN specification.

\begin{figure}
\centering
\begin{tikzpicture}[auto]
\begin{scope}
\tikzstyle{layer}=[draw=blue!70,rectangle,rounded corners, minimum width = 6cm, minimum height=5mm, node distance=1mm, very thick]
\tikzstyle{layer2}=[draw=green!70,rectangle,rounded corners, minimum width = 6cm, minimum height=5mm, node distance=1mm, very thick]
\node[layer] (l1) at (0,0) {IEEE 802.15.4 PHY};
\node[layer] (l2) [above=of l1] {IEEE 802.15.4 MAC};
\node[layer2] (l3) [above=of l2] {6LoWPAN adaptation layer};
\node[layer] (l4) [above=of l3] {IPv6};
\node[layer] (l5) [above=of l4] {UDP, ICMPv6};
\node[layer] (l6) [above=of l5] {Application layer};
\end{scope}
\end{tikzpicture}
\caption{6LoWPAN architecture}
\label{stack_6lowpan}
\end{figure}

\subsection{Routing in 6LoWPAN}

In order to address the lack of a routing protocol for 6LoWPAN networks, the IPv6 Routing Protocol for Low-Power and Lossy Networks (RPL) has been proposed in RFC6550 by IETF. Accordingly, RPL provides support for point-to-point, point-to-multipoint and multipoint-to-point traffic flows.

The RPL protocol is based on directed acyclic graph (DAG). DAGs are directed graphs formed by a collection of vertices and directed edges, where each edge connects one vertex to another, such that there is no way to start at some vertex v and follow a sequence of edges that eventually loops back to v again. All edges are contained in paths oriented toward and terminating at one or more root nodes. These root nodes are known as Low power and Lossy Network Border Routers (LBR), which are devices that connects the LLN to another routing domain such as a Local Area Network (LAN) or the internet, where a different routing protocol may be in operation. In addition to its functionality as a routing device, the LBR acts as a sink node to a WSN as well as a data collector or aggregator.

In RPL, a DAG grounded at a single LBR is called a Destination Oriented Directed Acyclic Graph (DODAG). For a specific DODAG each node is assigned to a rank such that rank increases as the node is far from the LBR. Note that the rank of the nodes along any path to the LBR must be monotonically decreasing, avoiding the routing loops, as shown in the figure \ref{RPL_DIO}. Therefore, forwarding a packet to the LBR roughly consist in choosing the neighbor node with the lowest rank.

\begin{figure}[h!tb]
\centering
\includegraphics[width=0.4\textwidth]{figures/RPL_DIO}
\caption{Example of a Destination Oriented Directed Acyclic Graph(DODAG).}
\label{RPL_DIO}
\end{figure}

Nodes running RPL exchange control messages to setup and maintain the DODAG, which in the 6LoWPAN implementation are ICMPv6 messages. The 1B code in the ICMPv6 header is used to differentiate between different sub-type of control messages. The sub-type used to build the DODAG is called DAG Information Object (DIO). All the nodes in the network regularly broadcast a DIO to its one-hop neighbors, indicating their activity and rank. The instant at which a node issues a DIO is governed by a Trickle timer, which is reset only when an inconsistency arises, i. e., very few DIOs are exchanged when the topology is stable. RPL provide optimized paths to one or more LBRs with very little information stored in the routing table. The information stored is limited to its one-hop neighbors and their parents in the DODAGs. A parent of a node within a DODAG is one of the immediate successors of the node on a path towards the DODAG root.

Despite of its advantages, the default RPL using DODAGs does not provide routes from the LBRs to other nodes in the network, which in RPL are known as down routes. Down refers to the direction from DODAG roots towards leaf nodes, following the reverse direction of DODAG edges. The availability of such routes is desirable in several scenarios, mainly in scenarios with actuators nodes and scenarios where selective queries to sensors nodes are required. Thus, a RPL router that requires a path from a LBR to itself should send a DAO (Destination Advertisement Object) message to the LBR through the DODAG edges. The nodes that receive a DAO message forward the message as soon as the timer DelayDAO expires, being this time determined by the implementation, according to [RFC6550]. Therefore, routes for any destination inside the network, other than the LBRs, are provided by these destinations through DAO messages.

The RPL specification defines two modes of operation for the DAO mechanism, storing and non-storing modes. In non-storing mode, each node has to propagate its parent list up to the root. After receiving such topology information, the root computes the path to the destination. Such mode of operating generally makes use of unicast DAO messages to the DODAG root. The storing mode is fully stateful, i.e., each intermediate router in the path towards the root node stores the routes to the destinations in its routing table. To make this possible, each intermediate node adds its downward route to the DAO message, which is unicast to the selected parent(s).

These down routes generated by DAO messages are extremely important to point-to-point communication in the network. An example of the necessity of P2P messages is a scenario where actuators require data from sensors to decide when and how to act. Therefore, if the application needs P2P communication, each pair of nodes must request at least one downward path in order to allow such message exchange. In the worst case, the message is sent from the source router towards the LBR and, thereafter, from the LBR to the destination node, as shown in figure \ref{RPL_DAO}. If the RPL protocol is being performed in the non-storing mode, all point-to-point communication will be conducted by one or more LBRs, which are the only nodes in the network that store downward routes.

\begin{figure}[h!tb]
\centering
\includegraphics[width=0.45\textwidth]{figures/RPL_DAO}
\caption{P2P communication between routers $B$ and $C$ through a DODAG root using RPL.}
\label{RPL_DAO}
\end{figure}

\subsection{Drawbacks of the RPL protocol}

The RPL protocol has several possible drawbacks, depending on the application. Generally, we can point out three usual problems. First, one can easily realize that the P2P routes provided by RPL can be much larger than the shortest available route, causing high traffic on the DODAGs routes (worsening nearby root nodes), as discussed in \citep{P2P_analysis_2010} and \citep{P2P-RPL_2011}. Second, the DAO message exchange may lead to excessive packet collisions, mainly in scenarios with lots of link losses. Thus, the generated downward routes are proactive and initiated by the destination. Therefore, in order to an actuator make a request to a sensor, the sensor should know that an actuator needs to communicate by point-to-point mode. Third, proactive routing also impacts on the size of the routing table, i.e, the more down routes exists, the greater the memory required to store those paths.

Even, there are problems related to the DAO operating modes. In non-storing mode, RPL requires the use of IPv6 source routing mechanism. Therefore, a Source Routing Header (SRH) for use strictly between RPL routers in the same RPL routing domain was proposed in RFC6554. However, RPL source routing implements a policy where each IPv6 hop between the source and destination of the source route is specified within the SRH. Such approach leads to a large overhead and increases the consumption of the already scarce bandwidth. Further, as the IEEE 802.15.4 standard has a limited maximum transmission unit (MTU), that may also imply in increased fragmentation. Therefore, successful delivery of an IP packet depends on the successful delivery of all possible fragments, which are not desirable once the LLNs are generally characterized by high packet loss rates.

In addition to the fragmentation issue, the maximum length of the routing header is limited to 255 octets [ref], which restricts the maximum path length to 127 hops if an address compression mechanism is applied [ref]. This limitation may exclude scenarios with long chain-like topologies, such as street lighting systems and traffic lights along a street.

In storing mode, each router has to be able to store all the routes downwards its position in the formed DODAGs. This implies that, for routers near to the root node, the required storage is only bounded by the number of paths to all other routers in the network. As RPL targets networks consisting of thousands of memory-constrained devices, the required storing capacity on these devices may not be compatible with the basic precepts of the WSANs.

Due to these not negligible drawbacks, it is wise to develop some work around able to improve the RPL protocol deficiencies, mainly that related with P2P messages. One of the possible approaches is the use of geographic routing techniques, which are routing algorithms known by its low overhead and high scalability features \citep{Karp_GPSR_2000, Position_Based_Routing_Ad_Hoc_2001, On_Optimal_Geographic_Routing_2007}.


\section{Geographic Routing}
\label{secGeographicRouting}

Geographic routing mainly relies on a really simple geographic greedy-forwarding strategy, where each router node must select a locally optimal neighbor with a positive progress towards the data packet destination \citep{survey_2007}. Such approach is largely known by its low overhead and scalability, which can easily be observed due to its low control message system, i.e., a router in a geographic routing strategy only needs to know its direct neighborhood.

In the geographic routing approach, the destination address is the position of the destination node, instead of a topological address. To discover a node position in the network, each router node must implement a location service. This service is responsible to determine its own position and the destination position. A node position could be obtained by pre-configuration if the node is stationary, or by a GPS receiver. As network nodes are static in the street lighting case, the location information of the nodes can be stored during the installation process. 

When considering realistic outdoor scenarios, such as a city, any block could turn into a void. A void occurs when all neighbors of a router node are farther away from the destination node than the router itself. In this case, the router fails to locate a next hop node through greedy strategy. If only the greedy-forwarding algorithm is used, packets have to be discarded when a void is reached. However, a void does not necessarily mean that there is no route to the destination, because if the network is connected, a valid topological path exists by circumventing the void. 

Many researchers argue that a dense deployment of wireless nodes can reduce the likelihood of the void occurrence in the network \citep{Position_Based_Routing_Ad_Hoc_2001, WSN_routing, survey_2007}. Indeed, in scenarios without obstacles that can be true. However, in outdoor large scale wireless networks it is unlikely to have such scenarios. Void handling techniques is an important issue to be addressed in such networks. 

Among the main non-hybrid void handling techniques, the Greedy Other Adaptive Face Routing (GOAFR) algorithm and its variations is one of the approaches that can get closer to the optimum path when traversing voids \citep{GOAFR_2008}. However, recently some hybrid strategies report having overcome the traditional geographic routing algorithms in terms of hop count, as the Coordinate Depth Forwarding (CDF) technique \citep{Denardin2011}.

Hybrid strategies allow aggregating several techniques in order to achieve better performance than a single technique. In the next section, we propose a hybrid approach that combines the simplicity of the DODAGs routes formed by RPL protocol, the scalability and guaranteed delivery feature of GOAFR algorithm and the inherent optimal paths of the CDF heuristics. However, instead of using directly the hop count in order to generate the optimal paths claimed by CDF, we propose to change its routing metric to the DODAG rank and study its behavior in network topologies based on real street maps. Therefore, the proposed approach allows to join the best characteristics of RPL and GOAFR into a new routing protocol, resulting in better performance than a single instance of each one would present. This new routing protocol is named \textit{GeoRank} to represent the integration of the geometric based behavior of GOAFR with the rank based behavior of RPL, and it will be explained in the following section.

\section{GeoRank}

Mainly due to its greedy step, GOAFR algorithm is able to perform quite well in networks with high link density, discovering paths often optimal or near-optimal paths, in contrast to RPL, which is constrained to route only through the DODAGs and thus, being unable to find the optimal paths. By the other hand, in networks with low link density, mainly around the critical density (\citep{GOAFR_2008}, GOAFR has a performance loss and may usually find paths longer than RPL. Therefore, a hybrid approach that leverages the best of both algorithms according to the network link density is proposed. This approach is mainly suitable for large scale and heterogeneous networks, such as a network of wireless streetlight nodes, where the link density varies from low to high depending of the more or less presence of obstructions and buildings in different places of the network.  The operation of \textit{GeoRank} is illustrated in figure \ref{state_machine} and the algorithm is outlined below in Algoritm \ref{alg}.

\small
\begin{algorithm}
\begin{algorithmic}
\caption{GeoRank}
\label{alg}
\small
\STATE \textbf{Step 1} - Store in the packet the DODAG root with the smallest angle to the source-destination
line. 
\STATE \textbf{Step 2} - Start with greedy step of GOAFR until: (case I) finding a void node (i.e. a node where GOAFR would switch to face  routing (OAFR)) or (case II) delivering the packet. In case I, store the current position in the packet and go to step 3.
\STATE \textbf{Step 3} - If the destination node is closer to the DODAG root (stored in the packet) than the current node or the DODAG root is closer to the destination node than the current node, forward to the next hop in the DODAG towards the root (i.e. upward route). If neither condition is satisfied, go to step 4. Whenever the current node position is closer to destination than the position stored in the packet in step 2, go to step 1.
%\STATE \textbf{Step 3} - If the destination node is closer to the DODAG root (stored in the packet) than the current node(when source and destination nodes are in the same quadrant) or the DODAG root is closer to the destination node than current node (when source and destination nodes are in different quadrants), forward to the next hop in the DODAG towards the DODAG root (i.e. upward route). If neither condition is satisfied, go to step 4. Whenever the current node position is closer to destination than the position stored in the packet in step 2, go to step 1.
\STATE \textbf{Step 4} -  Execute face routing mode of GOAFR until delivering the packet or returning to step 1.
\small
\end{algorithmic}
\end{algorithm}
\normalsize
\begin{figure}
\centering
\begin{tikzpicture}
[scale=1, every path/.style={>=latex}, no/.style={draw,circle,align=center,text width = 1.3cm}]
  \node[no] (a) at (0,0)  {\small GOAFR greedy routing};
  \node[no] (b) at (3,4)  {\small DODAG upward routing};
  \node[no] (c) at (6,0) {\small GOAFR face routing };

  \draw[->] (a) edge [bend left] node[sloped, anchor=center, above, text width=1.5cm] {\small Void node} (b);
  \draw[->] (b) edge [bend left] node[sloped, anchor=left,  below] {\small Back to greedy}(a);
  \draw[->] (b) edge node[sloped, anchor=center, above, text width=1.5cm] {\small Go to face}(c);
  \draw[->] (c) edge node[below] {\small Back to greedy} (a);
\end{tikzpicture}
\caption{GeoRank operation}
\label{state_machine}
\end{figure}

\section{Simulation Results}
\label{secSimulation}

In order to evaluate the proposed technique, simulations were performed in scenarios based on real street maps exported from the OpenStreetMap (OSM) data set, which is an open collaborative mapping project \citep{OSM}. The scenarios have been chosen to cover a wide range of possible street layouts. They have been populated with nodes with an average distance of $40m$, in order to simulate a real street lighting system, with network sizes ranging from 100 up to 400 nodes. A sample of the chosen scenarios are shown in figure \ref{sim_scenarios}. 

For every scenario, there were generated $1000$ random source-destination pairs, giving a coverage of up to $10$\% of the possible source-destination combinations. Also, every simulation was performed for $10$ different (random) positions of the DODAG root in every scenario, which gives a good coverage of the $5$ possible root placements (i.e. center and top/bottom-right/left corners). Then, for the each source-destination pair, the route was determined by each algorithm under test (RPL, GOAFR, \textit{GeoRank} and Dijkstra' algorithm for shortest path) and length of each route was measured in number of hops. The average length of the routes was computed and the results are shown in figure \ref{sim_results}.
%For RPL rank computation, it was used the Objective Function 0 as defined in RFC6552.
\begin{figure}
\centering
%\includegraphics[width=0.45\textwidth,natwidth=2024,natheight=402]{figures/sample_scenarios.eps}
\includegraphics[width=0.45\textwidth]{figures/sample_scenarios2.eps}
\caption{Sample of simulated scenarios with nodes populated.}
\label{sim_scenarios}
\end{figure}


\begin{figure}
\centering
\includegraphics[width=0.45\textwidth]{figures/final_result.eps}
\caption{Simulation results of the average route length for the routing algorithms (RPL, GOAFR, \textit{GeoRank}, and Dijkstra' algorithm for shortest path).}
\label{sim_results}
\end{figure}

\subsection{Remarks}

% a negligible difference between GOAFR and GOAFR+ variants of geographic routing. Also, it is noticeable 
The results shown that, for large radio ranges, where the average connectivity is high, the geographic routing is able to find near optimal routes. The reason for this is that with larger radio ranges the number of links that provide shorter paths are increased and the geographic routing is able to use them for routing, while RPL is constrained to the longer DODAG paths. By other hand, when the radio range is decreased, the network approaches the critical density, where geographic routing starts to reach more voids in the network and needs to resort more often to the face routing mechanism for circumventing the voids. Thus, the overall effect is that the use of geographic routing results in longer paths than RPL in lower link density conditions.

It is remarkable that the \textit{GeoRank} is able to reduce the length of the route found by geographic routing in lower link densities. It does so by avoiding to circumvent the void with face routing whenever it is possible to use the DODAG to perform this deviation. Thus, \textit{GeoRank} achieves a significant reduction of the path length when the number of voids is large (i.e. when the radio range is small) compared to geographic routing alone. By the other hand, when the radio range is increased, geographic routing performs better than RPL, and \textit{GeoRank} does not impact negatively its performance. Therefore, \textit{GeoRank} works as a selective method, that is able leverage the best of RPL and geographic routing, and being adaptive to the network density.

In a large scale network, as a smart street lighting, there may be some places where the link density is very low due to obstacles, such as in dense urban environments, while some places may have high link density due to less and lower buildings. Therefore, while in either case RPL or geographic routing alone would not be the best option, the remarkable adaptability of \textit{GeoRank} makes it the well suited to such variable link density case.

\section{Conclusions}
\label{secConclusion}

In this paper, a smart street lighting system using a 6LoWPAN-based wireless sensor network was proposed. Moreover, in order to improve the performance and scalability of the network, it was proposed a new routing protocol, named \textit{GeoRank}, which integrates the standardized RPL routing protocol for 6LoWPAN networks with the state-of-the-art GOAFR position-based routing algorithm. The results obtained from simulations on networks extracted from real street maps have shown that \textit{GeoRank} has an improved routing performance over GOAFR in low link density condition, while outperforming the RPL protocol in high link density condition by finding mostly optimal routes. Therefore, \textit{GeoRank} is an adaptive approach for scenarios with variable link densities. 

Further, it is remarked that \textit{GeoRank} is not required to use the highly bandwidth-consuming RPL DAO control messages, and is more scalable than storing-mode RPL according to memory usage. Finally, although \textit{GeoRank} is proposed for a smart street lighting system, it is highlighted that it may find applicability for other large-scale network scenarios where the link density is variable and the scalability of the network is a major concern.

%\section{Acknowledgments}
%\label{secAck}
%
%We thank the OpenStreetMap and its contributors.



%% The Appendices part is started with the command \appendix;
%% appendix sections are then done as normal sections
%% \appendix

%% \label{}

%% References
%%
%% Following citation commands can be used in the body text:
%%
%%  \citet{key}  ==>>  Jones et al. (1990)
%%  \citep{key}  ==>>  (Jones et al., 1990)
%%
%% Multiple citations as normal:
%% \citep{key1,key2}         ==>> (Jones et al., 1990; Smith, 1989)
%%                            or  (Jones et al., 1990, 1991)
%%                            or  (Jones et al., 1990a,b)
%% \cite{key} is the equivalent of \citet{key} in author-year mode
%%
%% Full author lists may be forced with \citet* or \citep*, e.g.
%%   \citep*{key}            ==>> (Jones, Baker, and Williams, 1990)
%%
%% Optional notes as:
%%   \citep[chap. 2]{key}    ==>> (Jones et al., 1990, chap. 2)
%%   \citep[e.g.,][]{key}    ==>> (e.g., Jones et al., 1990)
%%   \citep[see][pg. 34]{key}==>> (see Jones et al., 1990, pg. 34)
%%  (Note: in standard LaTeX, only one note is allowed, after the ref.
%%   Here, one note is like the standard, two make pre- and post-notes.)
%%
%%   \citealt{key}          ==>> Jones et al. 1990
%%   \citealt*{key}         ==>> Jones, Baker, and Williams 1990
%%   \citealp{key}          ==>> Jones et al., 1990
%%   \citealp*{key}         ==>> Jones, Baker, and Williams, 1990
%%
%% Additional citation possibilities
%%   \citeauthor{key}       ==>> Jones et al.
%%   \citeauthor*{key}      ==>> Jones, Baker, and Williams
%%   \citeyear{key}         ==>> 1990
%%   \citeyearpar{key}      ==>> (1990)
%%   \citetext{priv. comm.} ==>> (priv. comm.)
%%   \citenum{key}          ==>> 11 [non-superscripted]
%% Note: full author lists depends on whether the bib style supports them;
%%       if not, the abbreviated list is printed even when full requested.
%%
%% For names like della Robbia at the start of a sentence, use
%%   \Citet{dRob98}         ==>> Della Robbia (1998)
%%   \Citep{dRob98}         ==>> (Della Robbia, 1998)
%%   \Citeauthor{dRob98}    ==>> Della Robbia


%% References with bibTeX database:

\bibliographystyle{model2-names}
\bibliography{refs}


%% Authors are advised to submit their bibtex database files. They are
%% requested to list a bibtex style file in the manuscript if they do
%% not want to use model2-names.bst.

%% References without bibTeX database:


% \begin{thebibliography}{00}

%% \bibitem must have one of the following forms:
%%   \bibitem[Jones et al.(1990)]{key}...
%%   \bibitem[Jones et al.(1990)Jones, Baker, and Williams]{key}...
%%   \bibitem[Jones et al., 1990]{key}...
%%   \bibitem[\protect\citeauthoryear{Jones, Baker, and Williams}{Jones
%%       et al.}{1990}]{key}...
%%   \bibitem[\protect\citeauthoryear{Jones et al.}{1990}]{key}...
%%   \bibitem[\protect\astroncite{Jones et al.}{1990}]{key}...
%%   \bibitem[\protect\citename{Jones et al., }1990]{key}...
%%   \harvarditem[Jones et al.]{Jones, Baker, and Williams}{1990}{key}...
%%

% \bibitem[ ()]{}

% \end{thebibliography}

\end{document}

%%
%% End of file `elsarticle-template-2-harv.tex'.
